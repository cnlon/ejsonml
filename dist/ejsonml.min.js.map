{"version":3,"file":"ejsonml.min.js","sources":["../node_modules/ejsonml-render/src/index.js"],"sourcesContent":["export default function render (ejml, scope) {\n  return $render(ejml, scope, {})\n}\n\nrender.eval = function evaluate (func, scope, subScope) {\n  try {\n    return func(scope, subScope)\n  } catch (err) {\n    return undefined\n  }\n}\n\nfunction $render (ejml, scope, subScope) {\n  let res\n  if (!ejml) {\n    res = ''\n  } else if (Array.isArray(ejml)) {\n    let [node, attributes, ...children] = ejml\n    if (node === '*') {\n      node = createFragment(node)\n      computedAttributes(attributes, scope, subScope, (sub) => {\n        appendChildren(node, children, scope, sub)\n      })\n    } else {\n      node = createNode(node)\n      setAttributes(node, attributes, scope, subScope)\n      appendChildren(node, children, scope, subScope)\n    }\n    return node\n  } else if (typeof ejml === 'function') {\n    res = render.eval(ejml, scope, subScope)\n  } else {\n    res = ejml\n  }\n  return createTextNode(res)\n}\n\nfunction appendChildren (node, children, scope, subScope) {\n  children.forEach(child => {\n    node.appendChild($render(child, scope, subScope))\n  })\n}\n\nfunction setAttributes (node, attributes, scope, subScope) {\n  let attr, val\n  Object.keys(attributes).forEach(key => {\n    if (key[0] === '@') { // event\n      subScope = subScope || {}\n      node.addEventListener(key.slice(1), (event) => {\n        subScope.$event = event\n        render.eval(attributes[key], scope, subScope)\n      })\n    } else {\n      attr = createAttribute(key)\n      val = attributes[key]\n      if (typeof val === 'function') {\n        val = render.eval(val, scope, subScope)\n      }\n      attr.nodeValue = val\n      node.setAttributeNode(attr)\n    }\n  })\n}\n\nfunction computedAttributes (attributes, scope, subScope, callback) {\n  let $if = attributes['*if']\n  if ($if) {\n    $if = render.eval($if, scope, subScope)\n    if (!$if) return\n  }\n  let $items = attributes['*for']\n  if ($items) {\n    $items = render.eval($items, scope, subScope)\n    if ($items && $items.length) {\n      let sub = subScope\n              ? Object.assign({}, subScope)\n              : {}\n      let subKey = attributes['_forKey']\n      $items.forEach((v, k) => {\n        sub[subKey] = v\n        sub.$index = k\n        callback(sub)\n      })\n    }\n  } else {\n    callback(scope, subScope)\n  }\n}\n\nconst doc = window.document\n\nfunction createNode (tagName) {\n  return doc.createElement(tagName)\n}\n\nfunction createTextNode (text) {\n  return doc.createTextNode(text)\n}\n\nfunction createFragment () {\n  return doc.createDocumentFragment()\n}\n\nfunction createAttribute (attribute) {\n  return doc.createAttribute(attribute)\n}\n"],"names":["render","ejml","scope","$render","subScope","res","Array","isArray","node","attributes","children","createFragment","sub","createNode","eval","createTextNode","appendChildren","forEach","appendChild","child","setAttributes","attr","val","keys","key","addEventListener","slice","event","$event","createAttribute","nodeValue","setAttributeNode","computedAttributes","callback","$if","$items","length","Object","assign","subKey","v","k","$index","tagName","doc","createElement","text","createDocumentFragment","attribute","func","err","window","document"],"mappings":";;;;;4LAAe,SAASA,GAAQC,EAAMC,SAC7BC,GAAQF,EAAMC,MAWvB,QAASC,GAASF,EAAMC,EAAOE,MACzBC,aACCJ,EAEE,GAAIK,MAAMC,QAAQN,GAAO,kCACQA,GAAjCO,OAAMC,OAAeC,mBACb,MAATF,KACKG,EAAeH,KACHC,EAAYP,EAAOE,EAAU,SAACQ,KAChCJ,EAAME,EAAUR,EAAOU,SAGjCC,EAAWL,KACJA,EAAMC,EAAYP,EAAOE,KACxBI,EAAME,EAAUR,EAAOE,OAEjCI,yFACkB,kBAATP,GACVD,EAAOc,KAAKb,EAAMC,EAAOE,GAEzBH,SAjBA,SAmBDc,GAAeV,GAGxB,QAASW,GAAgBR,EAAME,EAAUR,EAAOE,KACrCa,QAAQ,cACVC,YAAYf,EAAQgB,EAAOjB,EAAOE,MAI3C,QAASgB,GAAeZ,EAAMC,EAAYP,EAAOE,MAC3CiB,UAAMC,gBACHC,KAAKd,GAAYQ,QAAQ,YACf,MAAXO,EAAI,MACKpB,QACNqB,iBAAiBD,EAAIE,MAAM,GAAI,SAACC,KAC1BC,OAASD,IACXb,KAAKL,EAAWe,GAAMtB,EAAOE,SAG/ByB,EAAgBL,KACjBf,EAAWe,GACE,kBAARF,OACHtB,EAAOc,KAAKQ,EAAKpB,EAAOE,MAE3B0B,UAAYR,IACZS,iBAAiBV,MAK5B,QAASW,GAAoBvB,EAAYP,EAAOE,EAAU6B,MACpDC,GAAMzB,EAAW,WACjByB,MACIlC,EAAOc,KAAKoB,EAAKhC,EAAOE,QAG5B+B,GAAS1B,EAAW,OACpB0B,MACOnC,EAAOc,KAAKqB,EAAQjC,EAAOE,GAChC+B,GAAUA,EAAOC,uBACfxB,GAAMR,EACAiC,OAAOC,UAAWlC,MAExBmC,EAAS9B,EAAA,UACNQ,QAAQ,SAACuB,EAAGC,KACbF,GAAUC,IACVE,OAASD,IACJ7B,WAIJV,EAAOE,IAMpB,QAASS,GAAY8B,SACZC,GAAIC,cAAcF,GAG3B,QAAS5B,GAAgB+B,SAChBF,GAAI7B,eAAe+B,GAG5B,QAASnC,WACAiC,GAAIG,yBAGb,QAASlB,GAAiBmB,SACjBJ,GAAIf,gBAAgBmB,2QApG7BhD,EAAOc,KAAO,SAAmBmC,EAAM/C,EAAOE,aAEnC6C,GAAK/C,EAAOE,GACnB,MAAO8C,WAkFX,IAAMN,GAAMO,OAAOC"}