{"version":3,"file":"ejsonml.js","sources":["../node_modules/ejsonml-render/src/index.js"],"sourcesContent":["export default function render (ejml, scope) {\n  return $render(ejml, scope, {})\n}\n\nrender.eval = function evaluate (func, scope, subScope) {\n  try {\n    return func(scope, subScope)\n  } catch (err) {\n    return undefined\n  }\n}\n\nfunction $render (ejml, scope, subScope) {\n  let res\n  if (!ejml) {\n    res = ''\n  } else if (Array.isArray(ejml)) {\n    let [node, attributes, ...children] = ejml\n    if (node === '*') {\n      node = createFragment(node)\n      computedAttributes(attributes, scope, subScope, (sub) => {\n        appendChildren(node, children, scope, sub)\n      })\n    } else {\n      node = createNode(node)\n      setAttributes(node, attributes, scope, subScope)\n      appendChildren(node, children, scope, subScope)\n    }\n    return node\n  } else if (typeof ejml === 'function') {\n    res = render.eval(ejml, scope, subScope)\n  } else {\n    res = ejml\n  }\n  return createTextNode(res)\n}\n\nfunction appendChildren (node, children, scope, subScope) {\n  children.forEach(child => {\n    node.appendChild($render(child, scope, subScope))\n  })\n}\n\nfunction setAttributes (node, attributes, scope, subScope) {\n  let attr, val\n  Object.keys(attributes).forEach(key => {\n    if (key[0] === '@') { // event\n      subScope = subScope || {}\n      node.addEventListener(key.slice(1), (event) => {\n        subScope.$event = event\n        render.eval(attributes[key], scope, subScope)\n      })\n    } else {\n      attr = createAttribute(key)\n      val = attributes[key]\n      if (typeof val === 'function') {\n        val = render.eval(val, scope, subScope)\n      }\n      attr.nodeValue = val\n      node.setAttributeNode(attr)\n    }\n  })\n}\n\nfunction computedAttributes (attributes, scope, subScope, callback) {\n  let $if = attributes['*if']\n  if ($if) {\n    $if = render.eval($if, scope, subScope)\n    if (!$if) return\n  }\n  let $items = attributes['*for']\n  if ($items) {\n    $items = render.eval($items, scope, subScope)\n    if ($items && $items.length) {\n      let sub = subScope\n              ? Object.assign({}, subScope)\n              : {}\n      let subKey = attributes['_forKey']\n      $items.forEach((v, k) => {\n        sub[subKey] = v\n        sub.$index = k\n        callback(sub)\n      })\n    }\n  } else {\n    callback(scope, subScope)\n  }\n}\n\nconst doc = window.document\n\nfunction createNode (tagName) {\n  return doc.createElement(tagName)\n}\n\nfunction createTextNode (text) {\n  return doc.createTextNode(text)\n}\n\nfunction createFragment () {\n  return doc.createDocumentFragment()\n}\n\nfunction createAttribute (attribute) {\n  return doc.createAttribute(attribute)\n}\n"],"names":[],"mappings":"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"}