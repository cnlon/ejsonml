{"version":3,"file":"ejsonml.js","sources":["../node_modules/ejsonml-render/src/index.js"],"sourcesContent":["export default function render (ejml, scope, global, subScope) {\n  let res\n  if (!ejml) {\n    res = ''\n  } else if (Array.isArray(ejml)) {\n    let [node, attributes, ...children] = ejml\n    if (node === '*') {\n      node = createFragment(node)\n      computedAttributes(attributes, scope, global, subScope, (sub) => {\n        appendChildren(node, children, scope, global, sub)\n      })\n    } else {\n      node = createNode(node)\n      setAttributes(node, attributes, scope, global, subScope)\n      appendChildren(node, children, scope, global, subScope)\n    }\n    return node\n  } else if (typeof ejml === 'function') {\n    res = render.eval(ejml, scope, global, subScope)\n  } else {\n    res = ejml\n  }\n  return createTextNode(res)\n}\n\nrender.eval = function evaluate (func, scope, global, subScope) {\n  try {\n    return func(scope, global, subScope || {})\n  } catch (err) {\n    return undefined\n  }\n}\n\nfunction createNode (tagName) {\n  return document.createElement(tagName)\n}\n\nfunction createTextNode (text) {\n  return document.createTextNode(text)\n}\n\nfunction createFragment () {\n  return document.createDocumentFragment()\n}\n\nfunction setAttributes (node, attributes, scope, global, subScope) {\n  let attr, val\n  Object.keys(attributes).forEach(key => {\n    if (key[0] === '@') { // event\n      subScope = subScope || {}\n      node.addEventListener(key.slice(1), (event) => {\n        subScope.$event = event\n        render.eval(attributes[key], scope, global, subScope)\n      })\n    } else {\n      attr = document.createAttribute(key)\n      val = attributes[key]\n      if (typeof val === 'function') {\n        val = render.eval(val, scope, global, subScope)\n      }\n      attr.nodeValue = val\n      node.setAttributeNode(attr)\n    }\n  })\n}\n\nfunction computedAttributes (attributes, scope, global, subScope, callback) {\n  let $if = attributes['*if']\n  if ($if) {\n    $if = render.eval($if, scope, global, subScope)\n    if (!$if) return\n  }\n  let $items = attributes['*for']\n  if ($items) {\n    $items = render.eval($items, scope, global, subScope)\n    let sub = subScope\n             ? Object.assign({}, subScope)\n             : {}\n    let subKey = attributes['_forKey']\n    ;($items || []).forEach((v, k) => {\n      sub[subKey] = v\n      sub.$index = k\n      callback(sub)\n    })\n  } else {\n    callback(scope, global, subScope)\n  }\n}\n\nfunction appendChildren (node, children, scope, global, subScope) {\n  children.forEach(child => {\n    node.appendChild(render(child, scope, global, subScope))\n  })\n}\n"],"names":[],"mappings":"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"}